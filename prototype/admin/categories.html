<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Categories - Admin - hweibo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="min-h-screen bg-white" data-admin-active="categories">
  <a href="../landing.html" class="fixed left-4 sm:left-6 top-6 z-50 text-sm sm:text-base font-extrabold text-zinc-900 hover:text-black transition-colors">
    HWEIBO
  </a>

  <div class="fixed left-4 sm:left-6 top-1/2 -translate-y-1/2 z-50">
    <nav data-admin-nav class="flex flex-col items-start">
      <a data-admin-id="dashboard" href="index.html"><span>Dashboard</span></a>
      <a data-admin-id="users" href="users.html"><span>Users</span></a>
      <a data-admin-id="categories" href="categories.html"><span>Categories</span></a>
      <a data-admin-id="new-user" href="new-user.html"><span>Add user</span></a>
      <a data-admin-id="seller-view" href="../seller/index.html"><span>Seller view</span></a>
      <a data-admin-id="buyer-view" href="../buyer/search.html"><span>Buyer view</span></a>
    </nav>
  </div>

  <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 pl-24 sm:pl-32">
    <div class="flex items-start justify-between gap-6">
      <div>
        <h1 class="text-3xl font-extrabold text-zinc-900">Categories</h1>
        <p class="mt-2 text-zinc-500">Manage product categories available for seller product creation.</p>
      </div>
      <span id="categoryCount" class="px-4 py-2 rounded-full border border-zinc-200 text-sm font-semibold text-zinc-700">0 categories</span>
    </div>

    <section class="mt-8 rounded-3xl border border-zinc-200 bg-white p-6">
      <form id="newCategoryForm" class="flex flex-col sm:flex-row gap-3">
        <input
          id="categoryName"
          class="flex-1 px-4 py-3 rounded-2xl border border-zinc-200 focus:outline-none focus:border-black"
          placeholder="Add category (e.g. Beauty)"
          required
        />
        <button type="submit" class="px-6 py-3 rounded-full bg-black text-white font-semibold hover:bg-zinc-800">Add category</button>
      </form>
      <p class="mt-3 text-xs text-zinc-500">Changes here automatically appear in seller "New product" category options.</p>
    </section>

    <section class="mt-4 rounded-3xl border border-zinc-200 bg-white p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-extrabold text-zinc-900">Managed categories</h2>
        <button id="resetCategories" type="button" class="px-4 py-2 rounded-full border border-zinc-200 text-sm font-semibold text-zinc-700 hover:border-zinc-400">
          Reset defaults
        </button>
      </div>
      <div id="categoriesList" class="space-y-3"></div>
      <p id="categoriesEmpty" class="hidden text-sm text-zinc-500">No categories found.</p>
    </section>
  </main>

  <script defer src="admin-demo.js"></script>
  <script defer src="admin-nav.js"></script>
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const DEFAULT_CATEGORIES = ["Accessories", "Shoes", "Audio", "Electronics", "Home", "Fashion"];
      const categoryCount = document.getElementById("categoryCount");
      const categoriesList = document.getElementById("categoriesList");
      const categoriesEmpty = document.getElementById("categoriesEmpty");
      const categoryInput = document.getElementById("categoryName");

      function readSellerProductCounts() {
        const raw = localStorage.getItem("hweibo.prototype.seller.products");
        let items = [];
        try {
          items = raw ? JSON.parse(raw) : [];
        } catch (_error) {
          items = [];
        }

        const counts = {};
        (Array.isArray(items) ? items : []).forEach((item) => {
          const category = String(item.category || "").trim();
          if (!category) return;
          counts[category.toLowerCase()] = (counts[category.toLowerCase()] || 0) + 1;
        });
        return counts;
      }

      function render() {
        const categories = window.AdminDemo.readCategories();
        const productCounts = readSellerProductCounts();

        categoryCount.textContent = `${categories.length} categories`;
        categoriesEmpty.classList.toggle("hidden", categories.length !== 0);

        categoriesList.innerHTML = categories.map((category) => {
          const usage = productCounts[category.toLowerCase()] || 0;
          const canDelete = categories.length > 1;
          return `
            <div class="rounded-2xl border border-zinc-200 bg-zinc-50 p-4 flex items-center justify-between gap-3">
              <div>
                <p class="font-semibold text-zinc-900">${category}</p>
                <p class="text-sm text-zinc-500">${usage} seller product${usage === 1 ? "" : "s"} using this category</p>
              </div>
              <button
                type="button"
                data-remove-category="${category}"
                ${canDelete ? "" : "disabled"}
                class="px-3 py-1.5 rounded-full border border-zinc-200 bg-white text-sm font-semibold text-zinc-700 hover:border-zinc-400 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Remove
              </button>
            </div>
          `;
        }).join("");
      }

      document.getElementById("newCategoryForm").addEventListener("submit", (event) => {
        event.preventDefault();
        window.AdminDemo.addCategory(categoryInput.value);
        categoryInput.value = "";
        render();
      });

      categoriesList.addEventListener("click", (event) => {
        const button = event.target.closest("[data-remove-category]");
        if (!button) return;
        window.AdminDemo.removeCategory(button.getAttribute("data-remove-category"));
        render();
      });

      document.getElementById("resetCategories").addEventListener("click", () => {
        window.AdminDemo.writeCategories(DEFAULT_CATEGORIES);
        render();
      });

      render();
    });
  </script>
</body>
</html>
